apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.metadata.configmap_name }}
  namespace: {{ .Values.metadata.namespace }}
  labels:
    {{- include "edgelake-operator.labels" . | nindent 4 }}
data:
  # Kubernetes deployment indicator
  IS_KUBERNETES: "true"

  # Proxy IP for service discovery
  PROXY_IP: "{{ .Values.metadata.namespace }}.{{ .Values.metadata.service_name }}.svc.cluster.local"

  # --- Directories ---
  ANYLOG_PATH: "{{ .Values.node_configs.directories.ANYLOG_PATH }}"
  LOCAL_SCRIPTS: "{{ .Values.node_configs.directories.LOCAL_SCRIPTS }}"
  TEST_DIR: "{{ .Values.node_configs.directories.TEST_DIR }}"

  # --- General ---
  {{- if .Values.node_configs.general.LICENSE_KEY }}
  LICENSE_KEY: "{{ .Values.node_configs.general.LICENSE_KEY }}"
  {{- end }}
  NODE_TYPE: "{{ .Values.node_configs.general.NODE_TYPE }}"
  NODE_NAME: "{{ include "edgelake-operator.nodeName" . }}"
  COMPANY_NAME: "{{ .Values.node_configs.general.COMPANY_NAME }}"
  DISABLE_CLI: "{{ .Values.node_configs.general.DISABLE_CLI }}"
  REMOTE_CLI: "{{ .Values.node_configs.general.REMOTE_CLI }}"

  # --- Geolocation ---
  {{- if .Values.node_configs.geolocation.LOCATION }}
  LOCATION: "{{ .Values.node_configs.geolocation.LOCATION }}"
  {{- end }}
  {{- if .Values.node_configs.geolocation.COUNTRY }}
  COUNTRY: "{{ .Values.node_configs.geolocation.COUNTRY }}"
  {{- end }}
  {{- if .Values.node_configs.geolocation.STATE }}
  STATE: "{{ .Values.node_configs.geolocation.STATE }}"
  {{- end }}
  {{- if .Values.node_configs.geolocation.CITY }}
  CITY: "{{ .Values.node_configs.geolocation.CITY }}"
  {{- end }}

  # --- Networking ---
  {{- if .Values.node_configs.networking.OVERLAY_IP }}
  OVERLAY_IP: "{{ .Values.node_configs.networking.OVERLAY_IP }}"
  {{- end }}
  ANYLOG_SERVER_PORT: "{{ .Values.node_configs.networking.ANYLOG_SERVER_PORT }}"
  ANYLOG_REST_PORT: "{{ .Values.node_configs.networking.ANYLOG_REST_PORT }}"
  {{- if .Values.node_configs.networking.ANYLOG_BROKER_PORT }}
  ANYLOG_BROKER_PORT: "{{ .Values.node_configs.networking.ANYLOG_BROKER_PORT }}"
  {{- end }}
  TCP_BIND: "{{ .Values.node_configs.networking.TCP_BIND }}"
  REST_BIND: "{{ .Values.node_configs.networking.REST_BIND }}"
  BROKER_BIND: "{{ .Values.node_configs.networking.BROKER_BIND }}"

  {{- if .Values.node_configs.networking.CONFIG_NAME }}
  CONFIG_NAME: "{{ .Values.node_configs.networking.CONFIG_NAME }}"
  {{- end }}
  {{- if .Values.node_configs.networking.NIC_TYPE }}
  NIC_TYPE: "{{ .Values.node_configs.networking.NIC_TYPE }}"
  {{- end }}
  TCP_THREADS: "{{ .Values.node_configs.networking.TCP_THREADS }}"
  REST_TIMEOUT: "{{ .Values.node_configs.networking.REST_TIMEOUT }}"
  REST_THREADS: "{{ .Values.node_configs.networking.REST_THREADS }}"
  BROKER_THREADS: "{{ .Values.node_configs.networking.BROKER_THREADS }}"

  # --- Database ---
  DB_TYPE: "{{ .Values.node_configs.database.DB_TYPE }}"
  {{- if .Values.node_configs.database.DB_USER }}
  DB_USER: "{{ .Values.node_configs.database.DB_USER }}"
  {{- end }}
  {{- if .Values.node_configs.database.DB_PASSWD }}
  DB_PASSWD: "{{ .Values.node_configs.database.DB_PASSWD }}"
  {{- end }}
  DB_IP: "{{ .Values.node_configs.database.DB_IP }}"
  DB_PORT: "{{ .Values.node_configs.database.DB_PORT }}"
  AUTOCOMMIT: "{{ .Values.node_configs.database.AUTOCOMMIT }}"
  ENABLE_NOSQL: "{{ .Values.node_configs.database.ENABLE_NOSQL }}"
  SYSTEM_QUERY: "{{ .Values.node_configs.database.SYSTEM_QUERY }}"
  MEMORY: "{{ .Values.node_configs.database.MEMORY }}"

  NOSQL_TYPE: "{{ .Values.node_configs.database.NOSQL_TYPE }}"
  {{- if .Values.node_configs.database.NOSQL_USER }}
  NOSQL_USER: "{{ .Values.node_configs.database.NOSQL_USER }}"
  {{- end }}
  {{- if .Values.node_configs.database.NOSQL_PASSWD }}
  NOSQL_PASSWD: "{{ .Values.node_configs.database.NOSQL_PASSWD }}"
  {{- end }}
  NOSQL_IP: "{{ .Values.node_configs.database.NOSQL_IP }}"
  NOSQL_PORT: "{{ .Values.node_configs.database.NOSQL_PORT }}"
  BLOBS_DBMS: "{{ .Values.node_configs.database.BLOBS_DBMS }}"
  BLOBS_REUSE: "{{ .Values.node_configs.database.BLOBS_REUSE }}"

  # --- Blockchain ---
  LEDGER_CONN: "{{ .Values.node_configs.blockchain.LEDGER_CONN }}"
  SYNC_TIME: "{{ .Values.node_configs.blockchain.SYNC_TIME }}"
  BLOCKCHAIN_SYNC: "{{ .Values.node_configs.blockchain.BLOCKCHAIN_SYNC }}"
  BLOCKCHAIN_SOURCE: "{{ .Values.node_configs.blockchain.BLOCKCHAIN_SOURCE }}"
  BLOCKCHAIN_DESTINATION: "{{ .Values.node_configs.blockchain.BLOCKCHAIN_DESTINATION }}"

  # --- Operator ---
  CLUSTER_NAME: "{{ .Values.node_configs.operator.CLUSTER_NAME }}"
  DEFAULT_DBMS: "{{ .Values.node_configs.operator.DEFAULT_DBMS }}"
  {{- if .Values.node_configs.operator.MEMBER }}
  MEMBER: "{{ .Values.node_configs.operator.MEMBER }}"
  {{- end }}
  ENABLE_HA: "{{ .Values.node_configs.operator.ENABLE_HA }}"
  START_DATE: "{{ .Values.node_configs.operator.START_DATE }}"
  OPERATOR_THREADS: "{{ .Values.node_configs.operator.OPERATOR_THREADS }}"

  ENABLE_PARTITIONS: "{{ .Values.node_configs.operator.ENABLE_PARTITIONS }}"
  TABLE_NAME: "{{ .Values.node_configs.operator.TABLE_NAME }}"
  PARTITION_COLUMN: "{{ .Values.node_configs.operator.PARTITION_COLUMN }}"
  PARTITION_INTERVAL: "{{ .Values.node_configs.operator.PARTITION_INTERVAL }}"
  PARTITION_KEEP: "{{ .Values.node_configs.operator.PARTITION_KEEP }}"
  PARTITION_SYNC: "{{ .Values.node_configs.operator.PARTITION_SYNC }}"

  # --- MQTT ---
  ENABLE_MQTT: "{{ .Values.node_configs.mqtt.ENABLE_MQTT }}"
  {{- if .Values.node_configs.mqtt.MQTT_BROKER }}
  MQTT_BROKER: "{{ .Values.node_configs.mqtt.MQTT_BROKER }}"
  {{- end }}
  MQTT_PORT: "{{ .Values.node_configs.mqtt.MQTT_PORT }}"
  {{- if .Values.node_configs.mqtt.MQTT_USER }}
  MQTT_USER: "{{ .Values.node_configs.mqtt.MQTT_USER }}"
  {{- end }}
  {{- if .Values.node_configs.mqtt.MQTT_PASSWD }}
  MQTT_PASSWD: "{{ .Values.node_configs.mqtt.MQTT_PASSWD }}"
  {{- end }}
  MQTT_LOG: "{{ .Values.node_configs.mqtt.MQTT_LOG }}"

  {{- if .Values.node_configs.mqtt.MSG_TOPIC }}
  MSG_TOPIC: "{{ .Values.node_configs.mqtt.MSG_TOPIC }}"
  {{- end }}
  MSG_DBMS: "{{ .Values.node_configs.mqtt.MSG_DBMS }}"
  MSG_TABLE: "{{ .Values.node_configs.mqtt.MSG_TABLE }}"
  MSG_TIMESTAMP_COLUMN: "{{ .Values.node_configs.mqtt.MSG_TIMESTAMP_COLUMN }}"
  MSG_VALUE_COLUMN: "{{ .Values.node_configs.mqtt.MSG_VALUE_COLUMN }}"
  MSG_VALUE_COLUMN_TYPE: "{{ .Values.node_configs.mqtt.MSG_VALUE_COLUMN_TYPE }}"

  # --- OPC-UA ---
  ENABLE_OPCUA: "{{ .Values.node_configs.opcua.ENABLE_OPCUA }}"
  {{- if .Values.node_configs.opcua.OPCUA_URL }}
  OPCUA_URL: "{{ .Values.node_configs.opcua.OPCUA_URL }}"
  {{- end }}
  {{- if .Values.node_configs.opcua.OPCUA_NODE }}
  OPCUA_NODE: "{{ .Values.node_configs.opcua.OPCUA_NODE }}"
  {{- end }}
  {{- if .Values.node_configs.opcua.OPCUA_FREQUENCY }}
  OPCUA_FREQUENCY: "{{ .Values.node_configs.opcua.OPCUA_FREQUENCY }}"
  {{- end }}

  # --- EtherNet/IP ---
  ENABLE_ETHERIP: "{{ .Values.node_configs.etherip.ENABLE_ETHERIP }}"
  SIMULATOR_MODE: "{{ .Values.node_configs.etherip.SIMULATOR_MODE }}"
  {{- if .Values.node_configs.etherip.ETHERIP_URL }}
  ETHERIP_URL: "{{ .Values.node_configs.etherip.ETHERIP_URL }}"
  {{- end }}
  {{- if .Values.node_configs.etherip.ETHERIP_FREQUENCY }}
  ETHERIP_FREQUENCY: "{{ .Values.node_configs.etherip.ETHERIP_FREQUENCY }}"
  {{- end }}

  # --- Aggregations ---
  ENABLE_AGGREGATIONS: "{{ .Values.node_configs.aggregations.ENABLE_AGGREGATIONS }}"
  AGGREGATION_TIME_COLUMN: "{{ .Values.node_configs.aggregations.AGGREGATION_TIME_COLUMN }}"
  AGGREGATION_VALUE_COLUMN: "{{ .Values.node_configs.aggregations.AGGREGATION_VALUE_COLUMN }}"

  # --- Monitoring ---
  MONITOR_NODES: "{{ .Values.node_configs.monitoring.MONITOR_NODES }}"
  STORE_MONITORING: "{{ .Values.node_configs.monitoring.STORE_MONITORING }}"
  SYSLOG_MONITORING: "{{ .Values.node_configs.monitoring.SYSLOG_MONITORING }}"

  # --- MCP ---
  MCP_AUTOSTART: "{{ .Values.node_configs.mcp.MCP_AUTOSTART }}"

  # --- Advanced ---
  DEPLOY_LOCAL_SCRIPT: "{{ .Values.node_configs.advanced.DEPLOY_LOCAL_SCRIPT }}"
  DEBUG_MODE: "{{ .Values.node_configs.advanced.DEBUG_MODE }}"
  COMPRESS_FILE: "{{ .Values.node_configs.advanced.COMPRESS_FILE }}"
  QUERY_POOL: "{{ .Values.node_configs.advanced.QUERY_POOL }}"
  WRITE_IMMEDIATE: "{{ .Values.node_configs.advanced.WRITE_IMMEDIATE }}"
  THRESHOLD_TIME: "{{ .Values.node_configs.advanced.THRESHOLD_TIME }}"
  THRESHOLD_VOLUME: "{{ .Values.node_configs.advanced.THRESHOLD_VOLUME }}"

  # --- Nebula VPN ---
  {{- if .Values.node_configs.nebula }}
  ENABLE_NEBULA: "{{ .Values.node_configs.nebula.ENABLE_NEBULA }}"
  NEBULA_NEW_KEYS: "{{ .Values.node_configs.nebula.NEBULA_NEW_KEYS }}"
  IS_LIGHTHOUSE: "{{ .Values.node_configs.nebula.IS_LIGHTHOUSE }}"
  {{- if .Values.node_configs.nebula.CIDR_OVERLAY_ADDRESS }}
  CIDR_OVERLAY_ADDRESS: "{{ .Values.node_configs.nebula.CIDR_OVERLAY_ADDRESS }}"
  {{- end }}
  {{- if .Values.node_configs.nebula.LIGHTHOUSE_IP }}
  LIGHTHOUSE_IP: "{{ .Values.node_configs.nebula.LIGHTHOUSE_IP }}"
  {{- end }}
  {{- if .Values.node_configs.nebula.LIGHTHOUSE_NODE_IP }}
  LIGHTHOUSE_NODE_IP: "{{ .Values.node_configs.nebula.LIGHTHOUSE_NODE_IP }}"
  {{- end }}
  {{- end }}
